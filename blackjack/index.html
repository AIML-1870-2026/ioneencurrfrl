<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pony Blackjack ★</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

  <style>
    /* ===================================
       CSS CUSTOM PROPERTIES
    =================================== */
    :root {
      /* Sky / panel colors */
      --sky-a:    #6ec6ea;
      --sky-b:    #b8dff7;
      --sky-c:    #ddc9f5;
      --panel:    rgba(255, 255, 255, 0.80);
      --panel2:   rgba(255, 255, 255, 0.60);
      --border:   rgba(255, 255, 255, 0.95);

      /* Text */
      --text:       #3b1f6e;
      --text-muted: #7c6a9a;
      --gold:       #d97706;

      /* MLP suit colors */
      --stars:      #9333ea;   /* Twilight Sparkle violet  ★ */
      --hearts:     #ec4899;   /* Pinkie Pie pink          ♥ */
      --gems:       #2563eb;   /* Rarity sapphire          ✦ */
      --horseshoes: #ea580c;   /* Applejack orange         ⁂ */

      /* Status */
      --success: #059669;
      --danger:  #dc2626;
    }

    /* ===================================
       RESET & BASE
    =================================== */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Inter', system-ui, sans-serif;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      overflow-x: hidden;
      background:
        linear-gradient(180deg,
          var(--sky-a)  0%,
          var(--sky-b) 45%,
          var(--sky-c) 100%);
      color: var(--text);
      position: relative;
    }

    /* ===================================
       BACKGROUND DECORATION (clouds + rainbow)
    =================================== */
    .bg-layer {
      position: fixed;
      inset: 0;
      pointer-events: none;
      overflow: hidden;
      z-index: 0;
    }

    /* Rainbow arc — sits at the top, only bottom arc visible */
    .rainbow {
      position: absolute;
      width: 160vw;
      height: 80vw;
      left: 50%;
      transform: translateX(-50%);
      top: -72vw;
      border-radius: 50%;
      background: transparent;
      box-shadow:
        0 0 0 16px rgba(255, 50,  50,  0.18),
        0 0 0 32px rgba(255, 140, 0,   0.15),
        0 0 0 48px rgba(255, 230, 0,   0.15),
        0 0 0 64px rgba(50,  200, 100, 0.14),
        0 0 0 80px rgba(50,  120, 255, 0.14),
        0 0 0 96px rgba(120, 50,  220, 0.13);
    }

    /* Clouds */
    .cloud {
      position: absolute;
      background: white;
      border-radius: 50px;
      opacity: 0.72;
    }
    .cloud::before, .cloud::after {
      content: '';
      position: absolute;
      background: white;
      border-radius: 50%;
    }
    .cloud-1 { width: 180px; height: 55px; top: 6%;  left: -20px;  animation: cloudDrift 38s linear infinite; }
    .cloud-1::before { width: 90px;  height: 80px;  top: -45px; left: 25px; }
    .cloud-1::after  { width: 60px;  height: 60px;  top: -32px; left: 85px; }

    .cloud-2 { width: 140px; height: 45px; top: 16%; right: -30px; animation: cloudDrift 52s linear infinite reverse; }
    .cloud-2::before { width: 70px;  height: 65px;  top: -38px; left: 20px; }
    .cloud-2::after  { width: 50px;  height: 50px;  top: -28px; left: 72px; }

    .cloud-3 { width: 220px; height: 62px; top: 34%; left: -40px;  animation: cloudDrift 65s linear infinite; animation-delay: -20s; }
    .cloud-3::before { width: 110px; height: 95px;  top: -55px; left: 35px; }
    .cloud-3::after  { width: 75px;  height: 72px;  top: -42px; left: 105px; }

    .cloud-4 { width: 160px; height: 50px; top: 55%; right: -20px; animation: cloudDrift 44s linear infinite reverse; animation-delay: -10s; }
    .cloud-4::before { width: 80px;  height: 72px;  top: -42px; left: 22px; }
    .cloud-4::after  { width: 55px;  height: 55px;  top: -30px; left: 80px; }

    .cloud-5 { width: 130px; height: 40px; top: 72%; left: -10px;  animation: cloudDrift 57s linear infinite; animation-delay: -35s; }
    .cloud-5::before { width: 65px;  height: 60px;  top: -35px; left: 18px; }
    .cloud-5::after  { width: 48px;  height: 48px;  top: -26px; left: 65px; }

    @keyframes cloudDrift {
      from { transform: translateX(0); }
      to   { transform: translateX(110vw); }
    }

    /* ===================================
       FLYING PONIES
    =================================== */
    .pony-wrap {
      position: absolute;
      pointer-events: none;
      opacity: 0.62;
    }

    .pony-svg { display: block; width: 100%; height: 100%; }

    /* Pony faces right — flies left→right */
    .pony-ltr { animation: ponyFlyR var(--pdur, 55s) linear infinite; }

    /* Pony faces left (SVG flipped) — flies right→left */
    .pony-rtl { animation: ponyFlyL var(--pdur, 55s) linear infinite; }
    .pony-rtl .pony-svg { transform: scaleX(-1); }

    @keyframes ponyFlyR {
      0%   { transform: translateX(-25vw) translateY(0); }
      25%  { transform: translateX(25vw)  translateY(-22px); }
      50%  { transform: translateX(50vw)  translateY(0); }
      75%  { transform: translateX(75vw)  translateY(-18px); }
      100% { transform: translateX(125vw) translateY(0); }
    }

    @keyframes ponyFlyL {
      0%   { transform: translateX(125vw) translateY(0); }
      25%  { transform: translateX(75vw)  translateY(-22px); }
      50%  { transform: translateX(50vw)  translateY(0); }
      75%  { transform: translateX(25vw)  translateY(-18px); }
      100% { transform: translateX(-25vw) translateY(0); }
    }

    /* Sparkle stars floating in bg */
    .sparkle {
      position: absolute;
      color: rgba(180, 100, 240, 0.35);
      font-size: 1rem;
      animation: sparkleFade 4s ease-in-out infinite;
      user-select: none;
    }
    @keyframes sparkleFade {
      0%, 100% { opacity: 0; transform: scale(0.6) rotate(0deg); }
      50%       { opacity: 1; transform: scale(1)   rotate(20deg); }
    }

    /* ===================================
       HEADER
    =================================== */
    header {
      position: relative;
      z-index: 10;
      background: rgba(255, 255, 255, 0.70);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border-bottom: 3px solid transparent;
      border-image: linear-gradient(90deg,
        #ff6b6b, #ffa500, #ffdd57, #7ec8a0, #5ba0f5, #9333ea, #ec4899) 1;
      padding: 0.75rem 1.5rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-shrink: 0;
    }

    .game-title {
      font-family: 'Cinzel', serif;
      font-size: 1.5rem;
      letter-spacing: 0.08em;
      background: linear-gradient(90deg, #9333ea, #ec4899, #2563eb, #ea580c, #9333ea);
      background-size: 200% auto;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      animation: rainbowShift 5s linear infinite;
    }

    @keyframes rainbowShift {
      from { background-position: 0% center; }
      to   { background-position: 200% center; }
    }

    .balance-display {
      font-family: 'Cinzel', serif;
      font-size: 1rem;
      color: var(--gold);
      font-weight: 700;
      text-shadow: 0 1px 3px rgba(0,0,0,0.15);
    }

    /* ===================================
       TABLE (main play area)
    =================================== */
    .table {
      position: relative;
      z-index: 5;
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 1.25rem 1rem 1.5rem;
      gap: 0.85rem;
    }

    /* ===================================
       HAND AREAS
    =================================== */
    .hand-area {
      width: 100%;
      max-width: 700px;
      background: var(--panel);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border: 2px solid var(--border);
      border-radius: 18px;
      padding: 0.85rem 1.25rem 1rem;
      min-height: 135px;
      box-shadow:
        0 4px 24px rgba(147, 51, 234, 0.10),
        0 1px 6px rgba(0,0,0,0.06);
    }

    .hand-label {
      font-family: 'Cinzel', serif;
      font-size: 0.68rem;
      letter-spacing: 0.18em;
      color: var(--text-muted);
      margin-bottom: 0.3rem;
    }

    .hand-score {
      font-family: 'Cinzel', serif;
      font-size: 1rem;
      color: var(--text);
      margin-bottom: 0.6rem;
      min-height: 1.4em;
    }

    .hand-score.bust      { color: var(--danger); font-weight: 700; }
    .hand-score.blackjack { color: #7c3aed;       font-weight: 700; }

    .cards-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.45rem;
      align-items: flex-start;
      min-height: 90px;
    }

    /* Split hands */
    .split-hands  { display: flex; gap: 1.25rem; flex-wrap: wrap; }

    .split-hand {
      flex: 1;
      min-width: 180px;
      background: rgba(255,255,255,0.55);
      border: 2px solid rgba(255,255,255,0.9);
      border-radius: 12px;
      padding: 0.7rem 0.85rem;
    }

    .split-hand.active {
      border-color: #9333ea;
      box-shadow: 0 0 16px rgba(147, 51, 234, 0.25);
    }

    .split-hand-label {
      font-size: 0.68rem;
      letter-spacing: 0.1em;
      color: var(--text-muted);
      margin-bottom: 0.4rem;
      font-family: 'Cinzel', serif;
    }

    .split-hand-score {
      font-size: 0.85rem;
      margin-top: 0.4rem;
      font-family: 'Cinzel', serif;
      color: var(--text);
    }

    .split-hand-score.bust { color: var(--danger); font-weight: 700; }

    /* ===================================
       CARDS
    =================================== */
    .card {
      width: 65px;
      height: 90px;
      border-radius: 10px;
      flex-shrink: 0;
      position: relative;
      animation: dealIn 0.3s ease both;
      filter: drop-shadow(0 3px 6px rgba(0,0,0,0.18));
    }

    @keyframes dealIn {
      from { transform: translateY(-32px) scale(0.80); opacity: 0; }
      to   { transform: translateY(0)     scale(1);    opacity: 1; }
    }

    /* Card face */
    .card-face {
      width: 100%;
      height: 100%;
      border-radius: 10px;
      background: #ffffff;
      border: 2.5px solid currentColor;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      padding: 4px 5px;
      overflow: hidden;
      position: relative;
    }

    /* Pastel tint on face — each suit has its own bg tint */
    .suit-stars      .card-tint { background: radial-gradient(ellipse at 50% 50%, #f3e8ff 0%, #ffffff 70%); }
    .suit-hearts     .card-tint { background: radial-gradient(ellipse at 50% 50%, #fce7f3 0%, #ffffff 70%); }
    .suit-gems       .card-tint { background: radial-gradient(ellipse at 50% 50%, #dbeafe 0%, #ffffff 70%); }
    .suit-horseshoes .card-tint { background: radial-gradient(ellipse at 50% 50%, #ffedd5 0%, #ffffff 70%); }

    .card-tint {
      position: absolute;
      inset: 0;
      border-radius: 8px;
      pointer-events: none;
    }

    .card-corner {
      display: flex;
      flex-direction: column;
      align-items: center;
      line-height: 1;
      position: relative;
      z-index: 1;
    }

    .card-corner.bottom {
      transform: rotate(180deg);
      align-self: flex-end;
    }

    .card-rank {
      font-weight: 800;
      font-size: 0.82rem;
      line-height: 1;
      color: inherit;
    }

    /* Cutie mark in card corner */
    .card-cutiemark-corner {
      width: 13px;
      height: 13px;
      display: block;
    }

    .card-cutiemark-corner svg {
      width: 100%;
      height: 100%;
      display: block;
    }

    /* Cutie mark in card center (watermark) */
    .card-cutiemark-center {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0.20;
      pointer-events: none;
      z-index: 1;
    }

    .card-cutiemark-center svg {
      width: 32px;
      height: 32px;
      display: block;
    }

    /* Suit color classes — applied to .card-face */
    .suit-stars      { color: var(--stars);      box-shadow: 0 0 0 0 transparent; }
    .suit-hearts     { color: var(--hearts); }
    .suit-gems       { color: var(--gems); }
    .suit-horseshoes { color: var(--horseshoes); }

    /* Card back — rainbow swirl */
    .card-back {
      width: 100%;
      height: 100%;
      border-radius: 10px;
      overflow: hidden;
      position: relative;
      border: 2.5px solid rgba(255,255,255,0.9);
      background:
        repeating-linear-gradient(
          -55deg,
          #ff6b6b55   0px,   #ff6b6b55   7px,
          #ffa50055   7px,   #ffa50055  14px,
          #ffdd5755  14px,   #ffdd5755  21px,
          #7ec8a055  21px,   #7ec8a055  28px,
          #5ba0f555  28px,   #5ba0f555  35px,
          #9333ea55  35px,   #9333ea55  42px,
          #ec489955  42px,   #ec489955  49px
        ),
        linear-gradient(135deg, #f0e6ff 0%, #e0f0ff 50%, #ffe0f5 100%);
    }

    .card-back::after {
      content: '♥';
      position: absolute;
      inset: 0;
      display: grid;
      place-items: center;
      font-size: 1.6rem;
      color: rgba(255, 255, 255, 0.85);
      text-shadow: 0 0 8px rgba(236, 72, 153, 0.6);
    }

    /* Card flip animation */
    .card.flip-reveal {
      animation: flipReveal 0.4s ease both;
    }

    @keyframes flipReveal {
      0%   { transform: rotateY(0deg);   }
      49%  { transform: rotateY(90deg);  }
      50%  { transform: rotateY(-90deg); }
      100% { transform: rotateY(0deg);   }
    }

    /* ===================================
       RESULT MESSAGE
    =================================== */
    .result-message {
      width: 100%;
      max-width: 700px;
      text-align: center;
      padding: 0.75rem 1.25rem;
      border-radius: 14px;
      font-family: 'Cinzel', serif;
      font-size: 1.1rem;
      letter-spacing: 0.04em;
      border: 2px solid transparent;
      backdrop-filter: blur(8px);
      display: none;
    }

    .result-message.visible { display: block; }

    .result-message.win {
      color: var(--success);
      border-color: var(--success);
      background: rgba(5, 150, 105, 0.10);
      animation: winGlow 0.7s ease;
    }

    .result-message.blackjack-win {
      color: #7c3aed;
      border-color: #9333ea;
      background: rgba(147, 51, 234, 0.10);
      animation: winGlow 0.7s ease;
    }

    .result-message.lose {
      color: var(--danger);
      border-color: var(--danger);
      background: rgba(220, 38, 38, 0.08);
    }

    .result-message.push {
      color: var(--text-muted);
      border-color: rgba(124, 106, 154, 0.4);
      background: rgba(255,255,255,0.5);
    }

    @keyframes winGlow {
      0%, 100% { transform: scale(1); }
      50%       { transform: scale(1.025); }
    }

    /* ===================================
       INSURANCE PROMPT
    =================================== */
    .insurance-prompt {
      width: 100%;
      max-width: 700px;
      background: rgba(255,255,255,0.85);
      backdrop-filter: blur(10px);
      border: 2px solid #9333ea;
      border-radius: 14px;
      padding: 0.9rem 1.25rem;
      text-align: center;
      box-shadow: 0 4px 20px rgba(147, 51, 234, 0.15);
      display: none;
    }

    .insurance-prompt.visible { display: block; }

    .insurance-prompt p {
      font-family: 'Cinzel', serif;
      color: #7c3aed;
      font-size: 0.9rem;
      margin-bottom: 0.7rem;
    }

    .ins-buttons { display: flex; gap: 0.6rem; justify-content: center; }

    /* ===================================
       BET SECTION
    =================================== */
    .bet-section {
      width: 100%;
      max-width: 700px;
      background: var(--panel);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border: 2px solid var(--border);
      border-radius: 18px;
      padding: 0.85rem 1.25rem;
      box-shadow: 0 4px 20px rgba(147, 51, 234, 0.08);
    }

    .bet-display {
      text-align: center;
      margin-bottom: 0.65rem;
    }

    .bet-label {
      font-family: 'Cinzel', serif;
      font-size: 0.68rem;
      letter-spacing: 0.16em;
      color: var(--text-muted);
    }

    .bet-amount {
      font-family: 'Cinzel', serif;
      font-size: 1.9rem;
      color: var(--gold);
      font-weight: 700;
      line-height: 1.2;
    }

    .bet-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 0.4rem;
      justify-content: center;
      margin-bottom: 0.65rem;
    }

    /* ===================================
       BUTTONS
    =================================== */
    .btn {
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-family: 'Inter', system-ui, sans-serif;
      font-weight: 700;
      transition: transform 0.1s ease, box-shadow 0.18s ease, opacity 0.18s ease;
      user-select: none;
    }

    .btn:active:not(:disabled) { transform: scale(0.95); }
    .btn:disabled { opacity: 0.38; cursor: not-allowed; }

    /* Chip / bet adjustment */
    .btn-chip {
      background: rgba(255,255,255,0.85);
      color: #7c3aed;
      border: 1.5px solid rgba(147, 51, 234, 0.3);
      padding: 0.4rem 0.75rem;
      font-size: 0.85rem;
      border-radius: 8px;
    }

    .btn-chip:hover:not(:disabled) {
      border-color: #9333ea;
      background: #f3e8ff;
      box-shadow: 0 0 10px rgba(147, 51, 234, 0.2);
    }

    /* Deal */
    .btn-deal {
      display: block;
      width: 100%;
      max-width: 200px;
      margin: 0 auto;
      padding: 0.65rem 1.5rem;
      background: linear-gradient(135deg, #9333ea, #7c3aed);
      color: #fff;
      font-size: 0.95rem;
      border-radius: 12px;
      box-shadow: 0 4px 16px rgba(147, 51, 234, 0.35);
      font-family: 'Cinzel', serif;
      letter-spacing: 0.08em;
    }

    .btn-deal:hover:not(:disabled) {
      box-shadow: 0 6px 24px rgba(147, 51, 234, 0.55);
      transform: translateY(-1px);
    }

    /* Action buttons */
    .action-section { width: 100%; max-width: 700px; }

    .action-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 0.55rem;
      justify-content: center;
    }

    .btn-action {
      padding: 0.6rem 1.2rem;
      font-size: 0.88rem;
      border-radius: 12px;
    }

    /* Hit — Rainbow Dash blue */
    .btn-hit {
      background: linear-gradient(135deg, #60a5fa, #2563eb);
      color: #fff;
      box-shadow: 0 3px 12px rgba(37, 99, 235, 0.30);
    }
    .btn-hit:hover:not(:disabled) {
      box-shadow: 0 5px 18px rgba(37, 99, 235, 0.50);
      transform: translateY(-1px);
    }

    /* Stand — Fluttershy yellow-green */
    .btn-stand {
      background: linear-gradient(135deg, #86efac, #22c55e);
      color: #14532d;
      box-shadow: 0 3px 12px rgba(34, 197, 94, 0.28);
    }
    .btn-stand:hover:not(:disabled) {
      box-shadow: 0 5px 18px rgba(34, 197, 94, 0.48);
      transform: translateY(-1px);
    }

    /* Double — Applejack gold */
    .btn-double {
      background: linear-gradient(135deg, #fcd34d, #f59e0b);
      color: #78350f;
      box-shadow: 0 3px 12px rgba(245, 158, 11, 0.28);
    }
    .btn-double:hover:not(:disabled) {
      box-shadow: 0 5px 18px rgba(245, 158, 11, 0.48);
      transform: translateY(-1px);
    }

    /* Split — Pinkie Pie pink */
    .btn-split {
      background: linear-gradient(135deg, #f9a8d4, #ec4899);
      color: #831843;
      box-shadow: 0 3px 12px rgba(236, 72, 153, 0.28);
    }
    .btn-split:hover:not(:disabled) {
      box-shadow: 0 5px 18px rgba(236, 72, 153, 0.48);
      transform: translateY(-1px);
    }

    /* Insurance — Rarity purple */
    .btn-insurance {
      background: linear-gradient(135deg, #c084fc, #9333ea);
      color: #fff;
      box-shadow: 0 3px 12px rgba(147, 51, 234, 0.28);
    }
    .btn-insurance:hover:not(:disabled) {
      box-shadow: 0 5px 18px rgba(147, 51, 234, 0.48);
      transform: translateY(-1px);
    }

    /* New Round */
    .btn-new-round {
      padding: 0.65rem 2rem;
      font-size: 0.95rem;
      border-radius: 12px;
      background: linear-gradient(135deg, #86efac, #22c55e);
      color: #14532d;
      font-family: 'Cinzel', serif;
      letter-spacing: 0.06em;
      box-shadow: 0 4px 14px rgba(34, 197, 94, 0.30);
    }
    .btn-new-round:hover:not(:disabled) {
      box-shadow: 0 6px 20px rgba(34, 197, 94, 0.50);
      transform: translateY(-1px);
    }

    /* Rebuy */
    .btn-rebuy {
      padding: 0.65rem 2rem;
      font-size: 0.95rem;
      border-radius: 12px;
      background: linear-gradient(135deg, #fcd34d, #f59e0b);
      color: #78350f;
      font-family: 'Cinzel', serif;
      letter-spacing: 0.06em;
      box-shadow: 0 4px 14px rgba(245, 158, 11, 0.30);
    }

    /* ===================================
       ANIMATIONS
    =================================== */
    @keyframes bust-shake {
      0%, 100% { transform: translateX(0); }
      20%       { transform: translateX(-7px); }
      40%       { transform: translateX(7px); }
      60%       { transform: translateX(-7px); }
      80%       { transform: translateX(7px); }
    }

    .bust-shake { animation: bust-shake 0.42s ease; }

    /* ===================================
       REDUCED MOTION
    =================================== */
    @media (prefers-reduced-motion: reduce) {
      .card, .card.flip-reveal,
      .cloud, .sparkle, .pony-wrap,
      .game-title { animation: none !important; }
      * { transition-duration: 0.01ms !important; }
    }

    /* ===================================
       MOBILE
    =================================== */
    @media (max-width: 767px) {
      .game-title      { font-size: 1.1rem; }
      .balance-display { font-size: 0.88rem; }
      .hand-area       { padding: 0.65rem 0.85rem; }
      .card            { width: 52px; height: 72px; }
      .card-rank       { font-size: 0.68rem; }
      .card-center-symbol { font-size: 1.25rem; }
      .bet-amount      { font-size: 1.45rem; }
      .btn-action      { padding: 0.5rem 0.85rem; font-size: 0.8rem; }
      .action-buttons  { gap: 0.4rem; }
    }
  </style>
</head>
<body>

  <!-- ========================
       BACKGROUND LAYER
  ======================== -->
  <div class="bg-layer" aria-hidden="true">
    <div class="rainbow"></div>
    <div class="cloud cloud-1"></div>
    <div class="cloud cloud-2"></div>
    <div class="cloud cloud-3"></div>
    <div class="cloud cloud-4"></div>
    <div class="cloud cloud-5"></div>
    <!-- Flying ponies — detailed MLP-style characters -->

    <!-- 1. Twilight Sparkle — alicorn (horn + wings), lavender, flies right -->
    <div class="pony-wrap pony-ltr" style="top:9%;width:170px;height:110px;--pdur:58s;animation-delay:0s">
      <svg class="pony-svg" viewBox="0 0 200 130" xmlns="http://www.w3.org/2000/svg">
        <!-- Upper wing behind body -->
        <path d="M100,72 Q70,32 15,26 Q40,44 80,67 Z" fill="#c8a0f0"/>
        <path d="M97,70 Q65,36 20,30" stroke="#9060c8" stroke-width="1" fill="none" opacity="0.5"/>
        <path d="M99,74 Q68,42 24,38" stroke="#9060c8" stroke-width="0.8" fill="none" opacity="0.4"/>
        <!-- Lower wing -->
        <path d="M88,88 Q55,110 22,120 Q48,104 76,90 Z" fill="#c8a0f0" opacity="0.8"/>
        <!-- Tail strands -->
        <path d="M38,70 Q18,53 5,57 Q10,70 28,72 Z" fill="#1e237a"/>
        <path d="M37,78 Q15,72 7,85 Q18,93 35,83 Z" fill="#8b5cf6"/>
        <path d="M37,86 Q19,91 11,105 Q24,103 37,91 Z" fill="#e879a0"/>
        <!-- Body -->
        <ellipse cx="88" cy="83" rx="52" ry="30" fill="#b67ee0"/>
        <!-- Neck -->
        <path d="M124,66 Q138,51 154,60 Q147,74 128,76 Z" fill="#b67ee0"/>
        <!-- Head -->
        <circle cx="154" cy="51" r="27" fill="#b67ee0"/>
        <!-- Ear -->
        <polygon points="141,28 147,14 156,28" fill="#b67ee0"/>
        <polygon points="143,28 147,18 154,28" fill="#e0b8f5"/>
        <!-- Muzzle -->
        <ellipse cx="175" cy="61" rx="13" ry="9" fill="#d0b0f0"/>
        <ellipse cx="181" cy="65" rx="2.5" ry="1.8" fill="#9050c0" opacity="0.4"/>
        <!-- Eye -->
        <ellipse cx="162" cy="46" rx="8" ry="10" fill="white"/>
        <ellipse cx="163" cy="47" rx="6" ry="8" fill="#7c3aed"/>
        <ellipse cx="164" cy="49" rx="3.2" ry="4.8" fill="#0f0030"/>
        <circle cx="159" cy="43" r="2" fill="white"/>
        <path d="M154,38 Q162,34 170,38" stroke="#220044" stroke-width="1.5" fill="none" stroke-linecap="round"/>
        <line x1="156" y1="38" x2="154" y2="35" stroke="#220044" stroke-width="1.2" stroke-linecap="round"/>
        <line x1="161" y1="36" x2="159" y2="33" stroke="#220044" stroke-width="1.2" stroke-linecap="round"/>
        <line x1="166" y1="36" x2="166" y2="33" stroke="#220044" stroke-width="1.2" stroke-linecap="round"/>
        <!-- Mane strands (dark blue, purple, pink) -->
        <path d="M148,27 Q132,35 126,50 Q124,63 126,73 Q131,52 141,36 Z" fill="#1e237a"/>
        <path d="M150,25 Q138,37 134,54 Q133,66 135,76 Q139,57 147,40 Z" fill="#8b5cf6"/>
        <path d="M153,26 Q149,40 149,56 Q150,68 153,77 Q151,61 151,43 Z" fill="#e879a0"/>
        <!-- Horn -->
        <path d="M148,25 L154,25 L151,5 Z" fill="#d0b0f0"/>
        <line x1="151" y1="5" x2="151" y2="25" stroke="#a070d0" stroke-width="0.5"/>
        <!-- Legs -->
        <rect x="108" y="107" width="11" height="18" rx="4" fill="#9a58c0"/>
        <rect x="121" y="106" width="11" height="17" rx="4" fill="#9a58c0"/>
        <rect x="58" y="107" width="11" height="18" rx="4" fill="#9a58c0"/>
        <rect x="71" y="106" width="11" height="17" rx="4" fill="#9a58c0"/>
        <!-- Hooves -->
        <ellipse cx="113" cy="124" rx="6" ry="3.5" fill="#7c3aad"/>
        <ellipse cx="126" cy="123" rx="6" ry="3.5" fill="#7c3aad"/>
        <ellipse cx="63" cy="124" rx="6" ry="3.5" fill="#7c3aad"/>
        <ellipse cx="76" cy="123" rx="6" ry="3.5" fill="#7c3aad"/>
      </svg>
    </div>

    <!-- 2. Rainbow Dash — pegasus, sky blue, flies left, fast, rainbow mane -->
    <div class="pony-wrap pony-rtl" style="top:5%;width:200px;height:130px;--pdur:24s;animation-delay:-5s">
      <svg class="pony-svg" viewBox="0 0 200 130" xmlns="http://www.w3.org/2000/svg">
        <!-- Large upper wing -->
        <path d="M102,70 Q65,22 8,16 Q38,38 82,65 Z" fill="#a8dff0"/>
        <path d="M99,68 Q62,26 12,22" stroke="#70b8d8" stroke-width="1" fill="none" opacity="0.6"/>
        <path d="M101,73 Q65,32 15,30" stroke="#70b8d8" stroke-width="0.8" fill="none" opacity="0.5"/>
        <path d="M103,67 Q68,20 16,14" stroke="#70b8d8" stroke-width="0.7" fill="none" opacity="0.4"/>
        <!-- Lower wing -->
        <path d="M90,87 Q52,114 16,126 Q46,108 76,90 Z" fill="#a8dff0" opacity="0.8"/>
        <!-- Tail — rainbow stripes -->
        <path d="M37,67 Q14,50 2,53 Q6,65 26,70 Z" fill="#ff3d3d"/>
        <path d="M37,73 Q12,58 2,62 Q8,74 28,76 Z" fill="#ff8c00"/>
        <path d="M37,79 Q12,66 4,71 Q10,83 30,82 Z" fill="#ffd700"/>
        <path d="M37,85 Q14,76 6,82 Q13,93 32,88 Z" fill="#3ddc84"/>
        <path d="M37,91 Q16,84 9,92 Q17,102 34,95 Z" fill="#4fc3f7"/>
        <path d="M37,97 Q18,92 12,102 Q22,110 37,101 Z" fill="#9333ea"/>
        <!-- Body -->
        <ellipse cx="88" cy="83" rx="52" ry="30" fill="#77c8e8"/>
        <!-- Neck -->
        <path d="M126,65 Q140,50 155,59 Q148,74 130,76 Z" fill="#77c8e8"/>
        <!-- Head -->
        <circle cx="155" cy="51" r="27" fill="#77c8e8"/>
        <!-- Ear -->
        <polygon points="142,28 148,13 157,28" fill="#77c8e8"/>
        <polygon points="144,28 148,17 155,28" fill="#a8dff0"/>
        <!-- Muzzle -->
        <ellipse cx="176" cy="61" rx="13" ry="9" fill="#a8dff0"/>
        <ellipse cx="182" cy="65" rx="2.5" ry="1.8" fill="#5090b0" opacity="0.45"/>
        <!-- Eye (magenta/rose) -->
        <ellipse cx="163" cy="46" rx="8" ry="10" fill="white"/>
        <ellipse cx="164" cy="47" rx="6" ry="8" fill="#ec4899"/>
        <ellipse cx="165" cy="49" rx="3.2" ry="4.8" fill="#1a0020"/>
        <circle cx="160" cy="43" r="2" fill="white"/>
        <path d="M155,38 Q163,33 171,38" stroke="#1a0020" stroke-width="1.5" fill="none" stroke-linecap="round"/>
        <line x1="157" y1="38" x2="155" y2="35" stroke="#1a0020" stroke-width="1.2" stroke-linecap="round"/>
        <line x1="162" y1="36" x2="160" y2="33" stroke="#1a0020" stroke-width="1.2" stroke-linecap="round"/>
        <line x1="167" y1="36" x2="167" y2="33" stroke="#1a0020" stroke-width="1.2" stroke-linecap="round"/>
        <!-- Mane — rainbow stripes -->
        <path d="M150,25 Q134,32 130,46 Q131,58 133,68 Q136,48 144,32 Z" fill="#ff3d3d"/>
        <path d="M152,25 Q140,35 136,51 Q137,63 139,73 Q141,54 149,38 Z" fill="#ff8c00"/>
        <path d="M153,25 Q143,37 141,54 Q142,66 144,76 Q145,58 151,42 Z" fill="#ffd700"/>
        <path d="M154,26 Q148,40 147,57 Q148,69 150,79 Q150,62 153,46 Z" fill="#3ddc84"/>
        <path d="M155,27 Q152,42 152,59 Q153,71 155,81 Q154,65 154,49 Z" fill="#4fc3f7"/>
        <path d="M156,28 Q155,44 156,61 Q157,73 159,82 Q158,67 157,51 Z" fill="#9333ea"/>
        <!-- Legs -->
        <rect x="108" y="107" width="11" height="18" rx="4" fill="#5aadcc"/>
        <rect x="121" y="106" width="11" height="17" rx="4" fill="#5aadcc"/>
        <rect x="58" y="107" width="11" height="18" rx="4" fill="#5aadcc"/>
        <rect x="71" y="106" width="11" height="17" rx="4" fill="#5aadcc"/>
        <!-- Hooves -->
        <ellipse cx="113" cy="124" rx="6" ry="3.5" fill="#3a8aaa"/>
        <ellipse cx="126" cy="123" rx="6" ry="3.5" fill="#3a8aaa"/>
        <ellipse cx="63" cy="124" rx="6" ry="3.5" fill="#3a8aaa"/>
        <ellipse cx="76" cy="123" rx="6" ry="3.5" fill="#3a8aaa"/>
      </svg>
    </div>

    <!-- 3. Pinkie Pie — pink, poofy bubble mane, flies right -->
    <div class="pony-wrap pony-ltr" style="top:44%;width:148px;height:96px;--pdur:52s;animation-delay:-21s">
      <svg class="pony-svg" viewBox="0 0 200 130" xmlns="http://www.w3.org/2000/svg">
        <!-- Wings -->
        <path d="M100,72 Q68,30 14,24 Q42,42 80,66 Z" fill="#fbbcdf"/>
        <path d="M96,70 Q63,36 18,32" stroke="#e088c0" stroke-width="0.8" fill="none" opacity="0.6"/>
        <!-- Lower wing -->
        <path d="M88,88 Q54,108 20,118 Q47,104 76,90 Z" fill="#fbbcdf" opacity="0.8"/>
        <!-- Tail — poofy bubble curls -->
        <circle cx="24" cy="76" r="15" fill="#e91e8c"/>
        <circle cx="12" cy="90" r="13" fill="#e91e8c"/>
        <circle cx="26" cy="98" r="11" fill="#e91e8c"/>
        <circle cx="14" cy="74" r="10" fill="#f472b6" opacity="0.55"/>
        <!-- Body -->
        <ellipse cx="88" cy="83" rx="52" ry="30" fill="#f5a0d3"/>
        <!-- Neck -->
        <path d="M126,65 Q140,50 155,59 Q148,74 130,76 Z" fill="#f5a0d3"/>
        <!-- Head -->
        <circle cx="155" cy="51" r="27" fill="#f5a0d3"/>
        <!-- Ear -->
        <polygon points="142,28 148,13 157,28" fill="#f5a0d3"/>
        <polygon points="144,28 148,17 155,28" fill="#fbbcdf"/>
        <!-- Muzzle -->
        <ellipse cx="176" cy="61" rx="13" ry="9" fill="#fbbcdf"/>
        <ellipse cx="182" cy="65" rx="2.5" ry="1.8" fill="#c050a0" opacity="0.45"/>
        <!-- Eye (blue, wide and happy) -->
        <ellipse cx="163" cy="46" rx="8" ry="10" fill="white"/>
        <ellipse cx="164" cy="47" rx="6" ry="8" fill="#60a5fa"/>
        <ellipse cx="165" cy="49" rx="3.2" ry="4.8" fill="#001050"/>
        <circle cx="160" cy="43" r="2" fill="white"/>
        <path d="M155,38 Q163,33 171,38" stroke="#330060" stroke-width="1.5" fill="none" stroke-linecap="round"/>
        <line x1="157" y1="38" x2="155" y2="35" stroke="#330060" stroke-width="1.2" stroke-linecap="round"/>
        <line x1="162" y1="36" x2="160" y2="33" stroke="#330060" stroke-width="1.2" stroke-linecap="round"/>
        <line x1="167" y1="36" x2="167" y2="33" stroke="#330060" stroke-width="1.2" stroke-linecap="round"/>
        <!-- Mane — poofy bubble curls -->
        <circle cx="136" cy="36" r="16" fill="#e91e8c"/>
        <circle cx="128" cy="52" r="14" fill="#e91e8c"/>
        <circle cx="140" cy="66" r="12" fill="#e91e8c"/>
        <circle cx="130" cy="34" r="10" fill="#f472b6" opacity="0.5"/>
        <circle cx="126" cy="48" r="9" fill="#f472b6" opacity="0.4"/>
        <!-- Legs -->
        <rect x="108" y="107" width="11" height="18" rx="4" fill="#e070b0"/>
        <rect x="121" y="106" width="11" height="17" rx="4" fill="#e070b0"/>
        <rect x="58" y="107" width="11" height="18" rx="4" fill="#e070b0"/>
        <rect x="71" y="106" width="11" height="17" rx="4" fill="#e070b0"/>
        <!-- Hooves -->
        <ellipse cx="113" cy="124" rx="6" ry="3.5" fill="#c05090"/>
        <ellipse cx="126" cy="123" rx="6" ry="3.5" fill="#c05090"/>
        <ellipse cx="63" cy="124" rx="6" ry="3.5" fill="#c05090"/>
        <ellipse cx="76" cy="123" rx="6" ry="3.5" fill="#c05090"/>
      </svg>
    </div>

    <!-- 4. Fluttershy — pegasus, pale yellow, very large wings, pink mane, flies left -->
    <div class="pony-wrap pony-rtl" style="top:22%;width:185px;height:120px;--pdur:70s;animation-delay:-38s">
      <svg class="pony-svg" viewBox="0 0 200 130" xmlns="http://www.w3.org/2000/svg">
        <!-- Very large upper wing -->
        <path d="M102,70 Q62,18 5,10 Q36,35 80,63 Z" fill="#fef3c7"/>
        <path d="M100,67 Q60,22 8,16" stroke="#c8a848" stroke-width="1" fill="none" opacity="0.6"/>
        <path d="M101,72 Q62,28 11,24" stroke="#c8a848" stroke-width="0.8" fill="none" opacity="0.5"/>
        <path d="M103,66 Q65,18 12,12" stroke="#c8a848" stroke-width="0.7" fill="none" opacity="0.4"/>
        <!-- Lower wing (oversized) -->
        <path d="M90,87 Q48,118 10,128 Q44,110 76,90 Z" fill="#fef3c7" opacity="0.8"/>
        <path d="M87,90 Q46,120 12,130" stroke="#c8a848" stroke-width="0.8" fill="none" opacity="0.45"/>
        <!-- Tail — long flowing pink -->
        <path d="M38,68 Q18,50 5,53 Q9,67 28,71 Z" fill="#f9a8d4"/>
        <path d="M37,76 Q14,68 5,81 Q15,93 34,83 Z" fill="#f9a8d4" opacity="0.85"/>
        <path d="M37,84 Q16,86 9,100 Q22,102 36,90 Z" fill="#fce7f3" opacity="0.9"/>
        <!-- Body -->
        <ellipse cx="88" cy="83" rx="52" ry="30" fill="#fde68a"/>
        <!-- Neck -->
        <path d="M126,65 Q140,50 155,59 Q148,74 130,76 Z" fill="#fde68a"/>
        <!-- Head -->
        <circle cx="155" cy="51" r="27" fill="#fde68a"/>
        <!-- Ear -->
        <polygon points="142,28 148,13 157,28" fill="#fde68a"/>
        <polygon points="144,28 148,17 155,28" fill="#fef3c7"/>
        <!-- Muzzle -->
        <ellipse cx="176" cy="61" rx="13" ry="9" fill="#fef3c7"/>
        <ellipse cx="182" cy="65" rx="2.5" ry="1.8" fill="#c0a030" opacity="0.4"/>
        <!-- Eye (teal, gentle, long lashes) -->
        <ellipse cx="163" cy="46" rx="8" ry="10" fill="white"/>
        <ellipse cx="164" cy="47" rx="6" ry="8" fill="#2dd4bf"/>
        <ellipse cx="165" cy="49" rx="3.2" ry="4.8" fill="#001520"/>
        <circle cx="160" cy="43" r="2" fill="white"/>
        <path d="M155,38 Q163,33 171,38" stroke="#003030" stroke-width="1.5" fill="none" stroke-linecap="round"/>
        <line x1="155" y1="38" x2="152" y2="34" stroke="#003030" stroke-width="1.3" stroke-linecap="round"/>
        <line x1="159" y1="36" x2="157" y2="32" stroke="#003030" stroke-width="1.3" stroke-linecap="round"/>
        <line x1="163" y1="35" x2="162" y2="31" stroke="#003030" stroke-width="1.3" stroke-linecap="round"/>
        <line x1="167" y1="36" x2="168" y2="33" stroke="#003030" stroke-width="1.2" stroke-linecap="round"/>
        <!-- Mane — long soft flowing pink -->
        <path d="M148,26 Q130,33 124,47 Q122,60 124,72 Q129,50 140,34 Z" fill="#f9a8d4"/>
        <path d="M150,25 Q136,34 131,49 Q130,62 132,72 Q136,52 145,36 Z" fill="#fce7f3"/>
        <path d="M152,25 Q140,36 138,53 Q138,65 140,75 Q142,57 150,40 Z" fill="#f9a8d4"/>
        <path d="M154,26 Q147,40 146,57 Q147,69 149,79 Q149,62 152,46 Z" fill="#fce7f3" opacity="0.85"/>
        <!-- Legs -->
        <rect x="108" y="107" width="11" height="18" rx="4" fill="#d4b060"/>
        <rect x="121" y="106" width="11" height="17" rx="4" fill="#d4b060"/>
        <rect x="58" y="107" width="11" height="18" rx="4" fill="#d4b060"/>
        <rect x="71" y="106" width="11" height="17" rx="4" fill="#d4b060"/>
        <!-- Hooves -->
        <ellipse cx="113" cy="124" rx="6" ry="3.5" fill="#b09040"/>
        <ellipse cx="126" cy="123" rx="6" ry="3.5" fill="#b09040"/>
        <ellipse cx="63" cy="124" rx="6" ry="3.5" fill="#b09040"/>
        <ellipse cx="76" cy="123" rx="6" ry="3.5" fill="#b09040"/>
      </svg>
    </div>

    <!-- 5. Applejack — golden, cowboy hat, orange mane, freckles, flies right -->
    <div class="pony-wrap pony-ltr" style="top:62%;width:132px;height:86px;--pdur:44s;animation-delay:-13s">
      <svg class="pony-svg" viewBox="0 0 200 130" xmlns="http://www.w3.org/2000/svg">
        <!-- Wings -->
        <path d="M100,72 Q68,30 14,24 Q42,42 80,66 Z" fill="#fde68a"/>
        <path d="M96,70 Q63,36 18,32" stroke="#c0a030" stroke-width="0.8" fill="none" opacity="0.6"/>
        <!-- Lower wing -->
        <path d="M88,88 Q54,108 20,118 Q47,104 76,90 Z" fill="#fde68a" opacity="0.8"/>
        <!-- Tail — orange, wavy -->
        <path d="M38,70 Q16,53 4,57 Q8,70 28,72 Z" fill="#f97316"/>
        <path d="M37,78 Q14,72 5,84 Q15,94 34,85 Z" fill="#f97316" opacity="0.8"/>
        <!-- Body -->
        <ellipse cx="88" cy="83" rx="52" ry="30" fill="#f0c040"/>
        <!-- Neck -->
        <path d="M126,65 Q140,50 155,59 Q148,74 130,76 Z" fill="#f0c040"/>
        <!-- Head -->
        <circle cx="155" cy="51" r="27" fill="#f0c040"/>
        <!-- Ear -->
        <polygon points="142,28 148,13 157,28" fill="#f0c040"/>
        <polygon points="144,28 148,17 155,28" fill="#fde68a"/>
        <!-- Hat brim -->
        <ellipse cx="152" cy="23" rx="24" ry="5" fill="#8B4513"/>
        <!-- Hat crown -->
        <path d="M138,23 Q140,6 152,3 Q163,6 165,23 Z" fill="#6B3010"/>
        <!-- Hat band -->
        <rect x="140" y="20" width="25" height="4" rx="1" fill="#a05520"/>
        <!-- Muzzle -->
        <ellipse cx="176" cy="61" rx="13" ry="9" fill="#fde68a"/>
        <ellipse cx="182" cy="65" rx="2.5" ry="1.8" fill="#c08020" opacity="0.45"/>
        <!-- Eye (green) -->
        <ellipse cx="163" cy="46" rx="8" ry="10" fill="white"/>
        <ellipse cx="164" cy="47" rx="6" ry="8" fill="#22c55e"/>
        <ellipse cx="165" cy="49" rx="3.2" ry="4.8" fill="#001a00"/>
        <circle cx="160" cy="43" r="2" fill="white"/>
        <path d="M155,38 Q163,33 171,38" stroke="#002200" stroke-width="1.5" fill="none" stroke-linecap="round"/>
        <line x1="157" y1="38" x2="155" y2="35" stroke="#002200" stroke-width="1.2" stroke-linecap="round"/>
        <line x1="162" y1="36" x2="160" y2="33" stroke="#002200" stroke-width="1.2" stroke-linecap="round"/>
        <line x1="167" y1="36" x2="167" y2="33" stroke="#002200" stroke-width="1.2" stroke-linecap="round"/>
        <!-- Mane — orange, partially tied back -->
        <path d="M148,27 Q133,34 128,48 Q127,60 129,70 Q134,50 143,34 Z" fill="#f97316"/>
        <path d="M150,26 Q138,36 134,52 Q133,64 135,74 Q139,55 148,38 Z" fill="#fdba74" opacity="0.75"/>
        <!-- Hair tie -->
        <circle cx="130" cy="66" r="4.5" fill="#7B3510"/>
        <!-- Freckles -->
        <circle cx="170" cy="55" r="2" fill="#d4882a" opacity="0.6"/>
        <circle cx="174" cy="60" r="1.8" fill="#d4882a" opacity="0.6"/>
        <circle cx="169" cy="62" r="1.5" fill="#d4882a" opacity="0.5"/>
        <!-- Legs -->
        <rect x="108" y="107" width="11" height="18" rx="4" fill="#d4a030"/>
        <rect x="121" y="106" width="11" height="17" rx="4" fill="#d4a030"/>
        <rect x="58" y="107" width="11" height="18" rx="4" fill="#d4a030"/>
        <rect x="71" y="106" width="11" height="17" rx="4" fill="#d4a030"/>
        <!-- Hooves -->
        <ellipse cx="113" cy="124" rx="6" ry="3.5" fill="#a07820"/>
        <ellipse cx="126" cy="123" rx="6" ry="3.5" fill="#a07820"/>
        <ellipse cx="63" cy="124" rx="6" ry="3.5" fill="#a07820"/>
        <ellipse cx="76" cy="123" rx="6" ry="3.5" fill="#a07820"/>
      </svg>
    </div>

    <!-- Floating sparkles -->
    <span class="sparkle" style="top:12%;left:8%;animation-delay:0s">★</span>
    <span class="sparkle" style="top:28%;left:92%;animation-delay:1.2s">✦</span>
    <span class="sparkle" style="top:48%;left:5%;animation-delay:2.4s">★</span>
    <span class="sparkle" style="top:66%;left:88%;animation-delay:0.7s">✦</span>
    <span class="sparkle" style="top:80%;left:15%;animation-delay:3.1s">★</span>
    <span class="sparkle" style="top:90%;left:75%;animation-delay:1.8s">✦</span>
  </div>

  <!-- ========================
       HEADER
  ======================== -->
  <header>
    <div class="game-title">★ Pony Blackjack</div>
    <div class="balance-display" id="balanceDisplay">Balance: $1,000</div>
  </header>

  <!-- ========================
       TABLE
  ======================== -->
  <main class="table">

    <!-- Dealer area -->
    <div class="hand-area" id="dealerArea">
      <div class="hand-label">DEALER</div>
      <div class="hand-score" id="dealerScore">—</div>
      <div class="cards-row" id="dealerCards"></div>
    </div>

    <!-- Player area -->
    <div class="hand-area" id="playerArea">
      <div class="hand-label">PLAYER</div>
      <div class="hand-score" id="playerScore">—</div>
      <div id="playerHandsContainer"></div>
    </div>

    <!-- Result message -->
    <div class="result-message" id="resultMessage"></div>

    <!-- Insurance prompt -->
    <div class="insurance-prompt" id="insurancePrompt">
      <p>Dealer shows an Ace — Take Insurance? (costs $<span id="insuranceCost">0</span>)</p>
      <div class="ins-buttons">
        <button class="btn btn-insurance btn-action" onclick="takeInsurance(true)">Yes, Insure</button>
        <button class="btn btn-chip btn-action"      onclick="takeInsurance(false)">No Thanks</button>
      </div>
    </div>

    <!-- Bet section -->
    <div class="bet-section" id="betSection">
      <div class="bet-display">
        <div class="bet-label">CURRENT BET</div>
        <div class="bet-amount" id="betAmount">$0</div>
      </div>
      <div class="bet-buttons" id="betButtons">
        <button class="btn btn-chip" onclick="adjustBet(-50)">−50</button>
        <button class="btn btn-chip" onclick="adjustBet(-10)">−10</button>
        <button class="btn btn-chip" onclick="adjustBet(-5)">−5</button>
        <button class="btn btn-chip" onclick="adjustBet(5)">+5</button>
        <button class="btn btn-chip" onclick="adjustBet(10)">+10</button>
        <button class="btn btn-chip" onclick="adjustBet(50)">+50</button>
      </div>
      <button class="btn btn-deal" id="dealBtn" onclick="startDeal()">Deal</button>
    </div>

    <!-- Action buttons -->
    <div class="action-section">
      <div class="action-buttons" id="actionButtons">
        <button class="btn btn-action btn-hit"    id="btnHit"      onclick="playerHit()">Hit</button>
        <button class="btn btn-action btn-stand"  id="btnStand"    onclick="playerStand()">Stand</button>
        <button class="btn btn-action btn-double" id="btnDouble"   onclick="playerDouble()">Double</button>
        <button class="btn btn-action btn-split"  id="btnSplit"    onclick="playerSplit()">Split</button>
        <button class="btn btn-new-round"         id="btnNewRound" onclick="newRound()" style="display:none">New Round</button>
        <button class="btn btn-rebuy"             id="btnRebuy"    onclick="rebuy()"    style="display:none">Rebuy $1,000</button>
      </div>
    </div>

  </main>

  <script>
    // ==============================
    // CONSTANTS
    // ==============================
    const SUITS   = ['stars', 'hearts', 'gems', 'horseshoes'];
    const SYMBOLS = { stars: '★', hearts: '♥', gems: '✦', horseshoes: '⁂' };
    const RANKS   = ['A','2','3','4','5','6','7','8','9','10','J','Q','K'];

    // ==============================
    // CUTIE MARK SVGs (inline, fill:currentColor)
    // ==============================

    // Twilight Sparkle — 6-pointed sparkle star + small satellite sparkles
    const CM_STARS = `<svg viewBox="0 0 40 40" xmlns="http://www.w3.org/2000/svg">
      <polygon points="20,7 22.5,15.7 31.3,13.5 25,20 31.3,26.5 22.5,24.3 20,33 17.5,24.3 8.7,26.5 15,20 8.7,13.5 17.5,15.7" fill="currentColor"/>
      <path d="M30 5 L31 8.2 L34.2 9.1 L31 10 L30 13.2 L29 10 L25.8 9.1 L29 8.2 Z" fill="currentColor" opacity="0.75"/>
      <path d="M7.5 27 L8.1 29.2 L10.3 29.8 L8.1 30.4 L7.5 32.6 L6.9 30.4 L4.7 29.8 L6.9 29.2 Z" fill="currentColor" opacity="0.62"/>
      <circle cx="29" cy="27" r="1.4" fill="currentColor" opacity="0.52"/>
      <circle cx="11" cy="12" r="1.1" fill="currentColor" opacity="0.45"/>
    </svg>`;

    // Pinkie Pie — 3 balloons (blue + yellow + yellow) with strings tied together
    const CM_HEARTS = `<svg viewBox="0 0 40 40" xmlns="http://www.w3.org/2000/svg">
      <ellipse cx="14" cy="19" rx="5.2" ry="7" fill="currentColor"/>
      <ellipse cx="26" cy="19" rx="5.2" ry="7" fill="currentColor" opacity="0.72"/>
      <ellipse cx="20" cy="11" rx="5.2" ry="7" fill="currentColor" opacity="0.88"/>
      <line x1="14" y1="26" x2="16.5" y2="35" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/>
      <line x1="26" y1="26" x2="23.5" y2="35" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/>
      <line x1="20" y1="18" x2="20" y2="35" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/>
      <circle cx="20" cy="35.5" r="1.6" fill="currentColor"/>
    </svg>`;

    // Rarity — 3 elongated diamonds arranged in a downward triangle
    const CM_GEMS = `<svg viewBox="0 0 40 40" xmlns="http://www.w3.org/2000/svg">
      <path d="M20 4 L26.5 15 L20 26 L13.5 15 Z" fill="currentColor"/>
      <path d="M9 18 L14.5 27.5 L9 37 L3.5 27.5 Z" fill="currentColor" opacity="0.80"/>
      <path d="M31 18 L36.5 27.5 L31 37 L25.5 27.5 Z" fill="currentColor" opacity="0.80"/>
    </svg>`;

    // Applejack — 3 apples (top center + bottom left + bottom right)
    const CM_HORSESHOES = `<svg viewBox="0 0 40 40" xmlns="http://www.w3.org/2000/svg">
      <circle cx="20" cy="13.5" r="8.5" fill="currentColor"/>
      <path d="M20 5 C19 2.8 18 1 20 0.5 C22 1 21 2.8 20 5 Z" fill="currentColor"/>
      <path d="M20 4.5 C22.5 1.8 26.5 2.5 25.5 6 C23.2 5 20 4.5 20 4.5 Z" fill="currentColor" opacity="0.80"/>
      <circle cx="11" cy="30" r="7" fill="currentColor" opacity="0.84"/>
      <path d="M11 23 C10 20.8 9 19 11 18.3 C13 19 12 20.8 11 23 Z" fill="currentColor" opacity="0.84"/>
      <path d="M11 22.5 C13.5 20 17.2 21 16.2 24.5 C14 23.5 11 22.5 11 22.5 Z" fill="currentColor" opacity="0.72"/>
      <circle cx="29" cy="30" r="7" fill="currentColor" opacity="0.84"/>
      <path d="M29 23 C28 20.8 27 19 29 18.3 C31 19 30 20.8 29 23 Z" fill="currentColor" opacity="0.84"/>
      <path d="M29 22.5 C31.5 20 35.2 21 34.2 24.5 C32 23.5 29 22.5 29 22.5 Z" fill="currentColor" opacity="0.72"/>
    </svg>`;

    const SUIT_CUTIEMARKS = {
      stars: CM_STARS, hearts: CM_HEARTS, gems: CM_GEMS, horseshoes: CM_HORSESHOES
    };

    // ==============================
    // GAME STATE
    // ==============================
    const game = {
      state: 'BETTING',    // 'BETTING' | 'PLAYING' | 'ROUND_COMPLETE'
      balance: 1000,
      bet: 0,
      deck: [],
      dealerHand: [],
      playerHands: [[]],   // array of hand arrays (max 2 after split)
      handBets: [0],       // bet amount per hand
      currentHandIndex: 0,
      dealerRevealed: false,
      insuranceBet: 0,
      offeringInsurance: false,
    };

    // ==============================
    // DECK MANAGEMENT
    // ==============================

    function buildDeck() {
      const deck = [];
      for (const suit of SUITS)
        for (const rank of RANKS)
          deck.push({ rank, suit, faceDown: false });
      return deck;
    }

    // Fisher-Yates shuffle
    function shuffle(deck) {
      for (let i = deck.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [deck[i], deck[j]] = [deck[j], deck[i]];
      }
      return deck;
    }

    function drawCard(faceDown = false) {
      if (game.deck.length === 0) game.deck = shuffle(buildDeck());
      const card = { ...game.deck.pop(), faceDown };
      return card;
    }

    // ==============================
    // HAND EVALUATION
    // ==============================

    function rankValue(rank) {
      if (rank === 'A') return 11;
      if (['J','Q','K'].includes(rank)) return 10;
      return parseInt(rank);
    }

    function handValue(hand) {
      let total = 0, aces = 0;
      for (const card of hand) {
        if (card.faceDown) continue;
        if (card.rank === 'A') aces++;
        total += rankValue(card.rank);
      }
      // Reduce aces from 11 → 1 as needed
      while (total > 21 && aces > 0) { total -= 10; aces--; }
      return total;
    }

    function isBlackjack(hand) {
      // Natural: exactly Ace + 10-value on initial two-card deal
      return hand.length === 2
        && hand.some(c => c.rank === 'A')
        && hand.some(c => ['10','J','Q','K'].includes(c.rank));
    }

    function isBust(hand) { return handValue(hand) > 21; }

    // ==============================
    // DEAL
    // ==============================

    function startDeal() {
      if (game.state !== 'BETTING') return;
      if (game.bet <= 0 || game.bet > game.balance) return;

      // Deduct bet, set up new round
      game.balance -= game.bet;
      game.deck            = shuffle(buildDeck());
      game.dealerHand      = [];
      game.playerHands     = [[]];
      game.handBets        = [game.bet];
      game.currentHandIndex = 0;
      game.dealerRevealed  = false;
      game.insuranceBet    = 0;
      game.offeringInsurance = false;

      // Deal: player, dealer, player, dealer (hole card face-down)
      game.playerHands[0].push(drawCard(false));
      game.dealerHand.push(drawCard(false));
      game.playerHands[0].push(drawCard(false));
      game.dealerHand.push(drawCard(true));   // hole card

      game.state = 'PLAYING';
      render();

      // Check immediate blackjacks
      const playerBJ = isBlackjack(game.playerHands[0]);
      const dealerBJ = peekDealerBlackjack();

      if (playerBJ || dealerBJ) {
        setTimeout(() => {
          revealDealerCards();
          resolveBlackjacks(playerBJ, dealerBJ);
        }, 600);
        return;
      }

      // Offer insurance when dealer shows an Ace
      if (game.dealerHand[0].rank === 'A') {
        game.offeringInsurance = true;
        render();
        return;
      }
      // Otherwise player's turn begins immediately
    }

    // Peek at dealer's hole card without revealing it
    function peekDealerBlackjack() {
      return game.dealerHand.length === 2
        && game.dealerHand.some(c => c.rank === 'A')
        && game.dealerHand.some(c => ['10','J','Q','K'].includes(c.rank));
    }

    // ==============================
    // INSURANCE
    // ==============================

    function takeInsurance(yes) {
      game.offeringInsurance = false;

      if (yes) {
        const cost = Math.floor(game.handBets[0] / 2);
        game.insuranceBet = cost;
        game.balance -= cost;
      }

      // Check if dealer has blackjack now
      if (peekDealerBlackjack()) {
        revealDealerCards();
        game.state = 'ROUND_COMPLETE';
        if (game.insuranceBet > 0) {
          // Insurance pays 2:1 → player gets back 3× insurance bet
          game.balance += game.insuranceBet * 3;
          showResult(`Dealer Blackjack! Insurance pays. You lose $${game.handBets[0]}.`, 'push');
        } else {
          showResult(`Dealer Blackjack. You lose $${game.handBets[0]}.`, 'lose');
        }
        render();
        return;
      }

      // No dealer blackjack — insurance bet forfeited (already deducted), play continues
      render();
    }

    // ==============================
    // PLAYER ACTIONS
    // ==============================

    function playerHit() {
      if (game.state !== 'PLAYING' || game.offeringInsurance) return;
      const hand = game.playerHands[game.currentHandIndex];
      hand.push(drawCard(false));
      render();

      if (isBust(hand)) {
        document.getElementById('playerArea').classList.add('bust-shake');
        setTimeout(() => {
          document.getElementById('playerArea').classList.remove('bust-shake');
          advanceHand();
        }, 480);
      }
    }

    function playerStand() {
      if (game.state !== 'PLAYING' || game.offeringInsurance) return;
      advanceHand();
    }

    function playerDouble() {
      if (game.state !== 'PLAYING' || game.offeringInsurance) return;
      const hand    = game.playerHands[game.currentHandIndex];
      const bet     = game.handBets[game.currentHandIndex];
      if (hand.length !== 2 || game.balance < bet) return;

      game.balance -= bet;
      game.handBets[game.currentHandIndex] *= 2;
      hand.push(drawCard(false));
      render();
      // Must stand after double
      setTimeout(advanceHand, 420);
    }

    function playerSplit() {
      if (game.state !== 'PLAYING' || game.offeringInsurance) return;
      const hand = game.playerHands[game.currentHandIndex];
      const bet  = game.handBets[game.currentHandIndex];
      if (hand.length !== 2) return;
      if (rankValue(hand[0].rank) !== rankValue(hand[1].rank)) return;
      if (game.balance < bet) return;
      if (game.playerHands.length >= 2) return; // no re-split

      // Deduct additional bet for second hand
      game.balance -= bet;

      // Split the second card into a new hand
      const card2 = hand.splice(1, 1)[0];
      game.playerHands.push([card2]);
      game.handBets.push(bet);

      // Deal one card to each hand
      hand.push(drawCard(false));
      game.playerHands[game.playerHands.length - 1].push(drawCard(false));

      render();
    }

    // ==============================
    // HAND ADVANCEMENT
    // ==============================

    function advanceHand() {
      game.currentHandIndex++;
      if (game.currentHandIndex < game.playerHands.length) {
        render(); // next split hand
      } else {
        dealerPlay(); // all hands done
      }
    }

    // ==============================
    // DEALER PLAY
    // ==============================

    function revealDealerCards() {
      game.dealerHand.forEach(c => c.faceDown = false);
      game.dealerRevealed = true;
    }

    function dealerPlay() {
      revealDealerCards();
      render();

      // Dealer draws cards one at a time with a delay
      function step() {
        const val = handValue(game.dealerHand);
        // Stand on 17 and above (S17 rule per spec)
        if (val >= 17) {
          evaluateRound();
          return;
        }
        // Hit below 17
        game.dealerHand.push(drawCard(false));
        render();
        setTimeout(step, 520);
      }

      setTimeout(step, 420);
    }

    // ==============================
    // ROUND EVALUATION
    // ==============================

    function resolveBlackjacks(playerBJ, dealerBJ) {
      const bet = game.handBets[0];
      if (playerBJ && dealerBJ) {
        game.balance += bet; // push — return bet
        showResult('Push — Both have Blackjack! Bet returned.', 'push');
      } else if (playerBJ) {
        const payout = Math.floor(bet * 1.5);
        game.balance += bet + payout; // return bet + 1.5× profit
        showResult(`Blackjack! ★ You win $${payout}!`, 'blackjack-win');
      } else {
        // Dealer blackjack, player no blackjack
        showResult(`Dealer Blackjack. You lose $${bet}.`, 'lose');
      }
      game.state = 'ROUND_COMPLETE';
      render();
    }

    function evaluateRound() {
      const dealerVal  = handValue(game.dealerHand);
      const results    = [];
      let   totalNet   = 0;

      for (let i = 0; i < game.playerHands.length; i++) {
        const hand    = game.playerHands[i];
        const bet     = game.handBets[i];
        const val     = handValue(hand);
        const bust    = val > 21;
        const prefix  = game.playerHands.length > 1 ? `Hand ${i + 1}: ` : '';

        if (bust) {
          results.push(`${prefix}Bust! You lose $${bet}`);
          totalNet -= bet;
        } else if (dealerVal > 21) {
          game.balance += bet * 2;
          results.push(`${prefix}Dealer busts! You win $${bet}`);
          totalNet += bet;
        } else if (val > dealerVal) {
          game.balance += bet * 2;
          results.push(`${prefix}You win $${bet}!`);
          totalNet += bet;
        } else if (val === dealerVal) {
          game.balance += bet; // return bet
          results.push(`${prefix}Push — Bet returned`);
        } else {
          results.push(`${prefix}Dealer wins. You lose $${bet}`);
          totalNet -= bet;
        }
      }

      let cls;
      if (totalNet > 0)      cls = 'win';
      else if (totalNet < 0) cls = 'lose';
      else                   cls = 'push';

      game.state = 'ROUND_COMPLETE';
      showResult(results.join(' | '), cls);
      render();
    }

    // ==============================
    // UI HELPERS
    // ==============================

    function showResult(msg, cls) {
      const el = document.getElementById('resultMessage');
      el.textContent = msg;
      el.className = `result-message visible ${cls}`;
    }

    function newRound() {
      game.state             = 'BETTING';
      game.dealerHand        = [];
      game.playerHands       = [[]];
      game.handBets          = [game.bet];
      game.currentHandIndex  = 0;
      game.dealerRevealed    = false;
      game.insuranceBet      = 0;
      game.offeringInsurance = false;
      document.getElementById('resultMessage').className = 'result-message';
      render();
    }

    function rebuy() {
      game.balance = 1000;
      game.bet     = 0;
      newRound();
    }

    function adjustBet(delta) {
      if (game.state !== 'BETTING') return;
      game.bet = Math.max(0, Math.min(game.balance, game.bet + delta));
      game.handBets = [game.bet];
      render();
    }

    // ==============================
    // CARD RENDERING
    // ==============================

    function renderCard(card, delayMs = 0) {
      const el = document.createElement('div');
      el.className = 'card';
      el.style.animationDelay = `${delayMs}ms`;

      if (card.faceDown) {
        const back = document.createElement('div');
        back.className = 'card-back';
        el.appendChild(back);
      } else {
        const cm   = SUIT_CUTIEMARKS[card.suit];
        const face = document.createElement('div');
        face.className = `card-face suit-${card.suit}`;
        face.innerHTML = `
          <div class="card-tint"></div>
          <div class="card-corner">
            <div class="card-rank">${card.rank}</div>
            <div class="card-cutiemark-corner">${cm}</div>
          </div>
          <div class="card-cutiemark-center">${cm}</div>
          <div class="card-corner bottom">
            <div class="card-rank">${card.rank}</div>
            <div class="card-cutiemark-corner">${cm}</div>
          </div>`;
        el.appendChild(face);
      }
      return el;
    }

    // ==============================
    // MAIN RENDER
    // ==============================

    function render() {
      const isBetting  = game.state === 'BETTING';
      const isPlaying  = game.state === 'PLAYING';
      const isComplete = game.state === 'ROUND_COMPLETE';

      // Balance
      document.getElementById('balanceDisplay').textContent =
        `Balance: $${game.balance.toLocaleString()}`;

      // Bet amount
      document.getElementById('betAmount').textContent = `$${game.bet}`;

      // Bet adjustment buttons — enabled only in BETTING
      document.querySelectorAll('.btn-chip').forEach(b => b.disabled = !isBetting);

      // Deal button
      const dealBtn = document.getElementById('dealBtn');
      dealBtn.disabled = !isBetting || game.bet <= 0 || game.bet > game.balance;
      dealBtn.style.display = isBetting ? '' : 'none';

      // === DEALER HAND ===
      const dealerScoreEl = document.getElementById('dealerScore');
      const dealerCardsEl = document.getElementById('dealerCards');
      dealerCardsEl.innerHTML = '';

      if (game.dealerHand.length === 0) {
        dealerScoreEl.textContent = '—';
        dealerScoreEl.className = 'hand-score';
      } else {
        game.dealerHand.forEach((card, i) =>
          dealerCardsEl.appendChild(renderCard(card, i * 140))
        );
        if (game.dealerRevealed) {
          const dv = handValue(game.dealerHand);
          dealerScoreEl.textContent = `Score: ${dv}${dv > 21 ? ' — Bust!' : ''}`;
          dealerScoreEl.className = dv > 21 ? 'hand-score bust' : 'hand-score';
        } else {
          const faceUpVal = handValue(game.dealerHand.filter(c => !c.faceDown));
          dealerScoreEl.textContent = `Score: ${faceUpVal} + ?`;
          dealerScoreEl.className = 'hand-score';
        }
      }

      // === PLAYER HAND(S) ===
      const playerScoreEl   = document.getElementById('playerScore');
      const handsContainer  = document.getElementById('playerHandsContainer');
      handsContainer.innerHTML = '';

      if (game.playerHands[0].length === 0) {
        playerScoreEl.textContent = '—';
        playerScoreEl.className = 'hand-score';
      } else if (game.playerHands.length === 1) {
        // Single hand
        const row = document.createElement('div');
        row.className = 'cards-row';
        game.playerHands[0].forEach((card, i) =>
          row.appendChild(renderCard(card, i * 140))
        );
        handsContainer.appendChild(row);

        const val = handValue(game.playerHands[0]);
        if (val > 21) {
          playerScoreEl.textContent = `Score: ${val} — Bust!`;
          playerScoreEl.className = 'hand-score bust';
        } else if (isBlackjack(game.playerHands[0])) {
          playerScoreEl.textContent = 'Blackjack! ★';
          playerScoreEl.className = 'hand-score blackjack';
        } else {
          playerScoreEl.textContent = `Score: ${val}`;
          playerScoreEl.className = 'hand-score';
        }
      } else {
        // Split hands
        playerScoreEl.textContent = '';
        const splitWrap = document.createElement('div');
        splitWrap.className = 'split-hands';

        game.playerHands.forEach((hand, hi) => {
          const handDiv = document.createElement('div');
          handDiv.className = 'split-hand' +
            (isPlaying && hi === game.currentHandIndex ? ' active' : '');

          const label = document.createElement('div');
          label.className = 'split-hand-label';
          label.textContent = `Hand ${hi + 1} — Bet $${game.handBets[hi]}`;
          handDiv.appendChild(label);

          const row = document.createElement('div');
          row.className = 'cards-row';
          hand.forEach((card, ci) => row.appendChild(renderCard(card, ci * 100)));
          handDiv.appendChild(row);

          const val = handValue(hand);
          const scoreDiv = document.createElement('div');
          scoreDiv.className = val > 21 ? 'split-hand-score bust' : 'split-hand-score';
          scoreDiv.textContent = val > 21 ? `${val} — Bust` : `Score: ${val}`;
          handDiv.appendChild(scoreDiv);

          splitWrap.appendChild(handDiv);
        });

        handsContainer.appendChild(splitWrap);
      }

      // === ACTION BUTTONS ===
      const curHand   = game.playerHands[game.currentHandIndex] || [];
      const showPlay  = isPlaying && !game.offeringInsurance;
      const isFirst2  = curHand.length === 2;
      const curBet    = game.handBets[game.currentHandIndex] || 0;

      const btnHit      = document.getElementById('btnHit');
      const btnStand    = document.getElementById('btnStand');
      const btnDouble   = document.getElementById('btnDouble');
      const btnSplit    = document.getElementById('btnSplit');
      const btnNewRound = document.getElementById('btnNewRound');
      const btnRebuy    = document.getElementById('btnRebuy');

      btnHit.style.display      = showPlay   ? '' : 'none';
      btnStand.style.display    = showPlay   ? '' : 'none';
      btnDouble.style.display   = showPlay   ? '' : 'none';
      btnSplit.style.display    = showPlay   ? '' : 'none';
      btnNewRound.style.display = isComplete ? '' : 'none';
      btnRebuy.style.display    = (isComplete && game.balance === 0) ? '' : 'none';

      if (showPlay) {
        const val = handValue(curHand);
        btnHit.disabled    = val >= 21;
        btnStand.disabled  = false;
        btnDouble.disabled = !isFirst2 || game.balance < curBet;
        btnSplit.disabled  =
          !isFirst2 ||
          game.playerHands.length >= 2 ||
          rankValue(curHand[0]?.rank) !== rankValue(curHand[1]?.rank) ||
          game.balance < curBet;
      }

      // Insurance prompt
      const insPrompt = document.getElementById('insurancePrompt');
      if (game.offeringInsurance) {
        insPrompt.classList.add('visible');
        document.getElementById('insuranceCost').textContent =
          Math.floor(game.handBets[0] / 2);
      } else {
        insPrompt.classList.remove('visible');
      }

      // Hide bet section during play / round complete
      document.getElementById('betSection').style.display =
        isBetting ? '' : 'none';
    }

    // ==============================
    // BOOT
    // ==============================
    render();
  </script>
</body>
</html>
